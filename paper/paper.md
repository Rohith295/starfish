---
title: 'starfish: scalable pipelines for image-based transcriptomics'
tags:
  - Python
  - xarray
  - skimage
  - microscopy
  - imaging
  - biology
  - single cell biology
  - spatial transcriptomics
  - MERFISH
  - In Situ Sequencing
  - osmFISH
  - smFISH
  - BaristaSeq
  - dartfish
  - starmap
  - seqFISH
authors:
  - name: Shannon Axelrod
    affiliation: 1
  - name: Matthew Cai
    orcid: 0000-0003-4998-6328
    affiliation: 1
  - name: Ambrose J. Carr
    orcid: 0000-0002-8457-2836
    affiliation: 1
  - name: Jeremy Freeman
    orcid: 0000-0001-7077-7972
    affiliation: 1
  - name: Deep Ganguli
    affiliation: 1
  - name: Justin T. Kiggins
    orcid: 0000-0002-4638-7015
    affiliation: 1
  - name: Brian Long
    orcid: 0000-0002-7793-5969
    affiliation: 2
  - name: Tony Tung
    affiliation: 1
  - name: Kevin Yamauchi
    orcid: 0000-0002-7818-1388
    affiliation: 3
affiliations:
 - name: Chan Zuckerberg Initiative
   index: 1
 - name: Allen Institute
   index: 2
 - name: Chan Zuckerberg Biohub
   index: 3
date: 24 April 2020
bibliography: paper.bib
---

# Summary

The exploding field of single cell transcriptomics has begun to enable deep analysis of gene expression and cell types, but spatial context is lost in the preparation of tissue for these assays.
Recent developments in biochemistry, microfluidics, and microscopy have come together to bring about an “alphabet soup” of technologies that enable sampling gene expression in situ, with varying levels of spatial resolution, sensitivity, and genetic depth.
These technologies promise to permit biologists to ask new questions about the spatial relationships between cell type and interactions between gene expression and cell morphology.
However, these assays generate very large microscopy datasets which pose challenges for data processing using standard analysis tools in microscopy. Furthermore, many of these assays require specialized analysis to decode gene expression from multiplexed experimental designs.

*starfish* is a Python library for processing images generated by microscopy-based spatial transcriptomics assays. It lets biologists build scalable pipelines that localize and quantify RNA transcripts in image data generated by any FISH or In Situ Sequencing method, from classic RNA single-molecule FISH to combinatorial barcoded assays. Image processing of an experiment is divided into fields of view (FOV) that correspond to the data produced by a microscope at a single location on a microscope slide. Built on top of scikit-image and xarray, *starfish* lets users register and pre-process images in each FOV, localize spots representing tagged RNA molecules in 3D, decode the identity of those molecules according to their experimental design, segment cells, assign the spots to cells, then aggregate spots into a cell x gene expression matrix. This spatially-annotated gene expression matrices can then be analyzed in downstream tools for single-cell biology, such as Seurat (@Seurat), Bioconductor (@Bioconductor), and ScanPy (@ScanPy).

To enable large scale processing of these data, *starfish* implements on a cloud-friendly data format that supports the 5-dimensional imaging data structures that these assays generate. Furthermore, *starfish* implements comprehensive logging of all data processing steps for provenance tracking, reproducibility, and transparency. *starfish* is built on top of popular Python tools like xarray (@xarray) and scikit-image (@scikit-image).

To help new users get started and support the broader single cell biology community in learning how to work with these data, *starfish* maintains example datasets and reference implementations ported from published assays, including
MERFISH (@MERFISH),
In Situ Sequencing (@ISS),
osmFISH (@osmFISH),
BaristaSeq (@BaristaSeq),
smFISH,
DartFISH,
starmap (@starmap),
and seqFISH (@seqFISH).

*starfish* is currently in use by multiple research groups, including the Allen Institute for Brain Science, the Chan Zuckerberg Biohub, and the Zhang Lab at UC San Diego. These groups support multiple large-scale projects profiling *in situ* gene expression, including the SpaceTx consortium, the Human Cell Atlas, the BRAIN Initiative Cell Census Network, and HubMap.


# Acknowledgements

We would like to acknowledge the following contributions, which have been invaluable to the development of starfish.

For direct contributions of code and documentation, we thank
Olga Botvinnik,
Gökçen Eraslan,
Kira Evans,
Marcus Kinsella,
Nicholas Mei,
Josh Moore,
Nicholas Sofroniew,
and Ola Tarkowska.

We would like to thank the members of the SpaceTx consortium for working closely with us to understand their image processing steps, port pipelines into starfish, and contribute example datasets.
We especially would like to thank
Jeff Moffitt and Xiaowei Zhuang for their help with the MERFISH pipeline and example data,
Marco Mignardi and Mats Nilsson for their help with the In Situ Sequencing pipeline and example data,
Simone Codeluppi and Sten Linnarsson for their help with the osmFISH pipeline and example data,
Xioayin Chen and Anthony Zador for their help with the BaristaSeq pipeline and example data,
Richard Que and Kun Zhang for their help with the dartfish pipeline and example data,
Xiao Wang, William Allen, and Karl Deisseroth for their help with the starmap pipeline and example data,
Dan Goodwin and Ed Boyden for their help with the ExFISH pipeline and example data,
Nico Pierson, Sheel Shah, and Long Cai for their help with the seqFISH pipeline and example data,
and Denis Shapiro for their help with the Imaging Mass Cytometry example data.

Finally, we would like to thank the SciTech team and Single Cell Program at the Chan Zuckerberg Initiative for their support of this work.

# References
